<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Whiteboard</title>
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <!-- Main Content Area -->
    <div class="main-content" style="width: 100vw;">
      <!-- Top Header (Cyan) -->
      <div class="header">
        <div class="title-group">
          <button id="new-file-btn" class="btn-collections" onclick="createNewFile()" title="Create new note">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="12" y1="18" x2="12" y2="12"></line>
              <line x1="9" y1="15" x2="15" y2="15"></line>
            </svg>
            <span class="collections-text">New Note</span>
          </button>
          <button id="collections-btn" class="btn-collections" onclick="navigateToCollections()" title="View all notes">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="7" height="7"></rect>
              <rect x="14" y="3" width="7" height="7"></rect>
              <rect x="14" y="14" width="7" height="7"></rect>
              <rect x="3" y="14" width="7" height="7"></rect>
            </svg>
            <span class="collections-text">Collections</span>
          </button>
          <button id="tag-cloud-btn" class="btn-collections" onclick="openTagCloud()" title="View tag cloud">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
              <line x1="7" y1="7" x2="7.01" y2="7"></line>
            </svg>
            <span class="collections-text">Tags</span>
          </button>
          <input type="text" id="document-title" placeholder="Untitled Document" class="title-input">
        </div>
        <div id="user-info" class="user-info">
          <!-- User info will be loaded here -->
        </div>
      </div>

      <!-- Editor Area (White with Magenta border on right) -->
      <div class="editor-container">
        <!-- Collage View (shown when no note is selected) -->
        <div id="collage-view" class="collage-view">
          <div class="collage-header">
            <div class="collage-search-container">
              <input type="text" id="search" placeholder="Search notes..." class="collage-search-input">
            </div>
          </div>
          <div id="collage-grid" class="collage-grid">
            <!-- Note cards will be populated here -->
          </div>
        </div>

        <!-- Editor Wrapper (shown when a note is selected) -->
        <div id="editor-wrapper" style="display: none;">
          <div id="editor"></div>
        </div>
      </div>

      <!-- Bottom Bar (Dark Green) -->
      <div class="footer">
        <div class="footer-left">
          <button id="privacy-btn" class="privacy-btn" onclick="togglePrivacyMode()" title="Toggle privacy mode">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
            </svg>
          </button>
          <button id="save-btn" class="btn-save" onclick="manualSave()" title="Save note (Ctrl+S)">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
              <polyline points="17 21 17 13 7 13 7 21"></polyline>
              <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
          </button>
          <span id="status">Ready</span>
        </div>
        <span id="word-count">0 words</span>
      </div>
    </div>
  </div>

  <!-- User Panel -->
  <div id="user-panel" class="user-panel">
    <div class="user-panel-header">
      <span id="panel-username"></span>
    </div>
    <div class="user-panel-menu">
      <div class="user-panel-item" onclick="openImportModal()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
        Import Notes (.md)
      </div>
      <div class="user-panel-item" onclick="exportAllNotes()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="17 8 12 3 7 8"></polyline>
          <line x1="12" y1="3" x2="12" y2="15"></line>
        </svg>
        Export All Notes
      </div>
      <div class="user-panel-separator"></div>
      <div class="user-panel-item" onclick="openChangePasswordModal()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M12 1v6m0 6v6"></path>
          <path d="M17 12h6M1 12h6"></path>
        </svg>
        Change Password
      </div>
      <div class="user-panel-item" onclick="manageSharedNotes()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
          <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
        </svg>
        Manage Shared Notes
      </div>
    </div>
  </div>

  <!-- Context Menu -->
  <div id="context-menu" class="context-menu">
    <div class="context-menu-item" onclick="deleteFile(); event.stopPropagation();">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="3 6 5 6 21 6"></polyline>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
      </svg>
      Delete
    </div>
    <div class="context-menu-item" onclick="manageTagsForFile(); event.stopPropagation();">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
        <line x1="7" y1="7" x2="7.01" y2="7"></line>
      </svg>
      Manage Tags
    </div>
    <div class="context-menu-item" onclick="setPasswordForFile(); event.stopPropagation();">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
      </svg>
      Password Protect
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item" onclick="shareFile(); event.stopPropagation();">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
      </svg>
      Share Link
    </div>
  </div>

  <!-- Tag Management Modal -->
  <div id="tag-modal" class="modal">
    <div class="modal-content">
      <h3>Manage Tags</h3>

      <div class="form-group">
        <label>Current Tags</label>
        <div id="tags-container" class="tags-input-container">
          <!-- Tags will be loaded here -->
        </div>
      </div>

      <div class="form-group">
        <label for="tag-input">Add New Tag</label>
        <div style="display: flex; gap: 10px;">
          <input type="text" id="tag-input" placeholder="Enter tag name">
          <button class="btn-primary" onclick="addTag()">Add</button>
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn-secondary" onclick="closeModal('tag-modal')">Cancel</button>
        <button type="button" class="btn-primary" onclick="saveTags()">Save</button>
      </div>
    </div>
  </div>

  <!-- Import Modal -->
  <div id="import-modal" class="modal">
    <div class="modal-content">
      <h3>Import Notes</h3>
      <div class="form-group">
        <label for="import-file">Select Markdown Files (.md)</label>
        <input type="file" id="import-file" accept=".md" multiple>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-secondary" onclick="closeModal('import-modal')">Cancel</button>
        <button type="button" class="btn-primary" onclick="importNotes()">Import</button>
      </div>
    </div>
  </div>

  <!-- Change Password Modal -->
  <div id="change-password-modal" class="modal">
    <div class="modal-content">
      <h3>Change Password</h3>
      <div class="form-group">
        <label for="current-password">Current Password</label>
        <input type="password" id="current-password" required>
      </div>
      <div class="form-group">
        <label for="new-password">New Password</label>
        <input type="password" id="new-password" required minlength="6">
      </div>
      <div class="form-group">
        <label for="confirm-password">Confirm New Password</label>
        <input type="password" id="confirm-password" required minlength="6">
      </div>
      <div id="change-password-error" class="error-message"></div>
      <div class="modal-actions">
        <button type="button" class="btn-secondary" onclick="closeModal('change-password-modal')">Cancel</button>
        <button type="button" class="btn-primary" onclick="changePassword()">Change Password</button>
      </div>
    </div>
  </div>

  <!-- Password Protection Modal -->
  <div id="password-modal" class="modal">
    <div class="modal-content">
      <h3>Password Protection</h3>

      <div class="form-group checkbox-group">
        <input type="checkbox" id="enable-password">
        <label for="enable-password">Enable password protection</label>
      </div>

      <div class="form-group">
        <label for="note-password">Password</label>
        <input type="password" id="note-password" placeholder="Enter password">
      </div>

      <div class="modal-actions">
        <button type="button" class="btn-secondary" onclick="closeModal('password-modal')">Cancel</button>
        <button type="button" class="btn-primary" onclick="savePassword()">Save</button>
      </div>
    </div>
  </div>

  <!-- Share Link Modal -->
  <div id="share-modal" class="modal">
    <div class="modal-content share-modal-content">
      <h3>Share Link</h3>
      <p class="share-description">Anyone with this link can view this note</p>

      <div class="share-link-container">
        <input type="text" id="share-link-input" readonly class="share-link-input">
        <button class="btn-primary" onclick="copyShareLink()">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
          </svg>
          Copy
        </button>
      </div>

      <div id="share-copy-feedback" class="share-copy-feedback">Link copied to clipboard!</div>

      <div class="modal-actions">
        <button type="button" class="btn-secondary" onclick="closeModal('share-modal')">Done</button>
      </div>
    </div>
  </div>

  <!-- Shared Links Manager Modal -->
  <div id="shared-links-modal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
      <h3>Shared Links</h3>
      <div id="shared-links-list" class="shared-links-list">
        <!-- Shared links will be loaded here -->
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-primary" onclick="closeModal('shared-links-modal')">Close</button>
      </div>
    </div>
  </div>

  <!-- Generic Alert Modal -->
  <div id="alert-modal" class="modal">
    <div class="modal-content">
      <h3 id="alert-title">Alert</h3>
      <p id="alert-message"></p>
      <div class="modal-actions">
        <button type="button" class="btn-primary" onclick="closeAlertModal()">OK</button>
      </div>
    </div>
  </div>

  <!-- Generic Confirm Modal -->
  <div id="confirm-modal" class="modal">
    <div class="modal-content">
      <h3 id="confirm-title">Confirm</h3>
      <p id="confirm-message"></p>
      <div class="modal-actions">
        <button type="button" class="btn-secondary" onclick="closeConfirmModal(false)">Cancel</button>
        <button type="button" class="btn-primary" onclick="closeConfirmModal(true)">Confirm</button>
      </div>
    </div>
  </div>

  <!-- Generic Prompt Modal -->
  <div id="prompt-modal" class="modal">
    <div class="modal-content">
      <h3 id="prompt-title">Input</h3>
      <p id="prompt-message"></p>
      <div class="form-group">
        <input type="text" id="prompt-input" placeholder="">
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-secondary" onclick="closePromptModal(null)">Cancel</button>
        <button type="button" class="btn-primary" onclick="closePromptModal(document.getElementById('prompt-input').value)">OK</button>
      </div>
    </div>
  </div>

  <!-- Tag Cloud Modal -->
  <div id="tag-cloud-modal" class="modal">
    <div class="modal-content" style="max-width: 700px;">
      <h3>Tag Cloud</h3>
      <p class="tag-cloud-subtitle">Click a tag to filter notes</p>
      <div id="tag-cloud-container" class="tag-cloud-container">
        <!-- Tag cloud will be rendered here -->
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-secondary" onclick="closeModal('tag-cloud-modal')">Close</button>
      </div>
    </div>
  </div>

  <!-- Quill Editor -->
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
  <!-- Turndown for HTML to Markdown -->
  <script src="https://unpkg.com/turndown/dist/turndown.js"></script>
  <!-- Marked for Markdown to HTML -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <!-- DOMPurify for HTML Sanitization -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.8/purify.min.js"></script>
  <!-- App Script -->
  <script src="app.js"></script>
</body>
</html>
